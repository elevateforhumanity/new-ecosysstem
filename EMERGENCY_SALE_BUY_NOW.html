
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:; frame-ancestors 'none';">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Now - EFH Emergency Sale</title>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    
                        
                        <div class="text-gray-600">Download immediately after payment</div>
                    </div>
                    <div class="bg-white p-3 rounded">
                        <div class="font-bold text-gray-900">Secure Payment</div>
                        <div class="text-gray-600">Stripe secured checkout</div>
                    </div>
                    <div class="bg-white p-3 rounded">
                        <div class="font-bold text-gray-900">Immediate Support</div>
                        <div class="text-gray-600">Get help within 24 hours</div>
                    </div>
                </div>
            </div>

            <!-- Alternative Payment Info -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mt-6">
                <h3 class="text-lg font-bold text-blue-800 mb-3">Need Alternative Payment?</h3>
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <h4 class="font-bold text-blue-700">Crypto Payments</h4>
                        <p class="text-blue-600">Bitcoin, Ethereum, USDC accepted</p>
                        <p class="text-xs text-blue-500">Email: crypto@elevateforhumanity.org</p>
                    </div>
                    <div>
                        <h4 class="font-bold text-blue-700">Bank Transfer</h4>
                        <p class="text-blue-600">Wire transfer available (1-2 days)</p>
                        <p class="text-xs text-blue-500">Email: payments@elevateforhumanity.org</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Stripe
        const stripe = Stripe('your_stripe_public_key'); // Replace with your publishable key
        
        // Countdown timer
        function startCountdown() {
            const saleEndTime = new Date().getTime() + (72 * 60 * 60 * 1000); // 72 hours from now
            
            const timer = setInterval(() => {
                const now = new Date().getTime();
                const timeLeft = saleEndTime - now;
                
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').innerHTML = 
                    `${days}d ${hours}h ${minutes}m ${seconds}s remaining`;
                
                if (timeLeft < 0) {
                    clearInterval(timer);
                    document.getElementById('countdown').innerHTML = "SALE ENDED";
                }
            }, 1000);
        }
        
        // Stripe Checkout
        async function buyNow(packageType, amountCents) {
            try {
                const response = await fetch('/api/checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        productName: `EFH Emergency Sale - ${packageType.replace('_', ' ')} Package`,
                        unitAmount: amountCents,
                        quantity: 1,
                        metadata: {
                            package_type: packageType,
                            sale_type: 'emergency_72hr',
                            customer_email: prompt('Enter your email for instant access:') || '',
                            priority: 'urgent'
                        }
                    })
                });
                
                const session = await response.json();
                
                if (session.url) {
                    window.location.href = session.url;
                } else {
                    alert('Payment processing error. Please try again or contact support.');
                }
            } catch (error) {
                console.error('Checkout error:', error);
                alert('Payment processing error. Please try again or contact support.');
            }
        }
        
        // BNPL Checkout
        async function payWithBNPL(packageType, amountCents) {
            const email = prompt('Enter your email for payment plan:');
            if (!email) return;
            
            try {
                const response = await fetch('/api/bnpl/checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        programSlug: 'efh-emergency-sale',
                        planId: amountCents <= 300000 ? '3_months' : '6_months',
                        customerEmail: email,
                        metadata: {
                            package_type: packageType,
                            sale_type: 'emergency_72hr',
                            original_amount: amountCents
                        }
                    })
                });
                
                const result = await response.json();
                
                if (result.checkout_url) {
                    window.location.href = result.checkout_url;
                } else {
                    alert('BNPL setup error. Please try direct payment or contact support.');
                }
            } catch (error) {
                console.error('BNPL error:', error);
                alert('BNPL setup error. Please try direct payment or contact support.');
            }
        }
        
        // Alternative payment methods
        function payWithPayPal(packageType, amount) {
            const email = prompt('Enter your email:');
            if (!email) return;
            
            alert(`PayPal payment option:\n\nSend $${amount.toLocaleString()} to:\npayments@elevateforhumanity.org\n\nInclude: "${packageType} package - ${email}" in notes\n\nYou'll receive access within 2 hours of payment confirmation.`);
        }
        
        function payWithVenmo(packageType, amount) {
            const email = prompt('Enter your email:');
            if (!email) return;
            
            alert(`Venmo payment option:\n\nSend $${amount.toLocaleString()} to:\n@ElevateForHumanity\n\nInclude: "${packageType} - ${email}" in notes\n\nYou'll receive access within 2 hours of payment confirmation.`);
        }
        
        // Start countdown on page load
        startCountdown();
        
        // Track page views
        console.log('ðŸš¨ Emergency Sale Page Loaded:', new Date().toISOString());
    </script>
</body>
</html>
