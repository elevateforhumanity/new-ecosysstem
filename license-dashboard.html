<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:; frame-ancestors 'none';">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>License Dashboard - Elevate Platform</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  
  
  <div class="grid md:grid-cols-3 gap-6 mb-8">
    <div class="bg-white rounded-xl shadow-lg p-6 text-center license-card">
      <div class="text-3xl mb-3">ðŸ›’</div>
      <h3 class="font-bold mb-2">Purchase License</h3>
      <p class="text-gray-600 text-sm mb-4">Get a new license for Elevate Platform</p>
      <a href="/elevate-store.html" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
        Visit Store
      </a>
    </div>
    
    <div class="bg-white rounded-xl shadow-lg p-6 text-center license-card">
      <div class="text-3xl mb-3">ðŸ“§</div>
      <h3 class="font-bold mb-2">Support</h3>
      <p class="text-gray-600 text-sm mb-4">Need help with your license?</p>
      <a href="mailto:support@elevateforhumanity.com" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm">
        Contact Us
      </a>
    </div>
    
    <div class="bg-white rounded-xl shadow-lg p-6 text-center license-card">
      <div class="text-3xl mb-3">ðŸ“š</div>
      <h3 class="font-bold mb-2">Documentation</h3>
      <p class="text-gray-600 text-sm mb-4">Learn how to use your license</p>
      <button class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm">
        View Docs
      </button>
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="bg-white rounded-xl shadow-lg p-6">
    <h3 class="text-xl font-bold mb-4">ðŸ“Š License Activity</h3>
    <div class="text-gray-600 text-center py-8">
      <div class="text-4xl mb-3">ðŸ“ˆ</div>
      <p>License usage analytics will appear here</p>
      <p class="text-sm mt-2">Track downloads, validations, and usage patterns</p>
    </div>
  </div>

</main>

<!-- Notification -->
<div 
  x-show="notification.show" 
  x-transition
  :class="notification.type === 'success' ? 'bg-green-600' : 'bg-red-600'"
  class="fixed top-4 right-4 text-white px-6 py-3 rounded-lg shadow-lg z-50"
>
  <span x-text="notification.message"></span>
</div>

<script>
  function licenseDashboard() {
    return {
      licenseInput: '',
      licenseInfo: null,
      notification: { show: false, message: '', type: 'success' },

      async checkLicense() {
        if (!this.licenseInput.trim()) {
          this.showNotification('Please enter a license key', 'error');
          return;
        }

        try {
          // First get license info
          const infoResponse = await fetch('/api/license-info', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ licenseKey: this.licenseInput })
          });
          
          const info = await infoResponse.json();
          
          // Then validate
          const validateResponse = await fetch('/api/validate-license', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ licenseKey: this.licenseInput })
          });
          
          const validation = await validateResponse.json();
          
          this.licenseInfo = { ...info, ...validation };
          
          if (validation.valid) {
            this.showNotification('License validated successfully!', 'success');
          } else {
            this.showNotification(`License validation failed: ${validation.reason}`, 'error');
          }
          
        } catch (error) {
          this.showNotification('Error checking license. Please try again.', 'error');
          console.error('License check error:', error);
        }
      },

      async renewLicense() {
        try {
          const response = await fetch('/api/renew-license', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ licenseKey: this.licenseInput })
          });
          
          const result = await response.json();
          
          if (response.ok) {
            this.showNotification('License renewed successfully!', 'success');
            this.licenseInput = result.newLicense;
            this.checkLicense(); // Refresh the display
          } else {
            this.showNotification(result.error || 'Renewal failed', 'error');
          }
          
        } catch (error) {
          this.showNotification('Error renewing license. Please try again.', 'error');
          console.error('License renewal error:', error);
        }
      },

      formatDate(dateString) {
        return new Date(dateString).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
      },

      showNotification(message, type = 'success') {
        this.notification = { show: true, message, type };
        setTimeout(() => {
          this.notification.show = false;
        }, 3000);
      }
    }
  }
</script>

</body>
</html>