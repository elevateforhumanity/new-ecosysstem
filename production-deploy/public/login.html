<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sign in â€“ Elevate for Humanity</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>
  
  <header class="site-header" role="banner">
    <nav class="nav" aria-label="Primary navigation">
      <a class="brand" href="/" aria-label="Elevate for Humanity home">
        <img src="https://cdn.elevateforhumanity.org/images/brand/efh-logo.svg" alt="Elevate for Humanity" height="40" width="200">
      </a>
    </nav>
  </header>

  <main class="section" id="main">
    <div style="max-width: 400px; margin: 2rem auto; text-align: center;">
      <h1>Sign in to Student Portal</h1>
      <p>Use your Google account to access the student portal, enrollment system, and learning management system.</p>
      
      <button class="btn btn-primary" id="googleBtn" style="width: 100%; margin: 2rem 0;">
        Sign in with Google
      </button>
      
      <p id="msg" aria-live="polite" style="color: var(--danger); margin-top: 1rem;"></p>
      
      <div style="margin-top: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 0.5rem; text-align: left;">
        <h3>Need Help?</h3>
        <p><strong>Students:</strong> Use the Google account provided during enrollment.</p>
        <p><strong>Staff:</strong> Use your organizational Google account.</p>
        <p><strong>Issues?</strong> Contact support at <a href="mailto:support@elevateforhumanity.org">support@elevateforhumanity.org</a> or (317) 555-WORK.</p>
      </div>
    </div>
  </main>

  <footer class="site-footer" role="contentinfo">
    <section class="footer-grid">
      <div>
        <h3>Contact Information</h3>
        <p>
          <strong>Phone:</strong> <a href="tel:+1-317-555-9675">(317) 555-WORK</a><br>
          <strong>Email:</strong> <a href="mailto:info@elevateforhumanity.org">info@elevateforhumanity.org</a><br>
          <strong>Address:</strong> 7009 E 56th St, Indianapolis, IN 46226
        </p>
      </div>
      <div>
        <h3>Legal Compliance</h3>
        <ul class="linklist">
          <li><a href="/policies/eo.html">Equal Opportunity Is the Law</a></li>
          <li><a href="/policies/grievance.html">WIOA Grievance & Discrimination</a></li>
          <li><a href="/policies/veterans.html">Priority of Service (Veterans)</a></li>
          <li><a href="/policies/accessibility.html">Accessibility (WCAG 2.2 AA)</a></li>
        </ul>
      </div>
    </section>
    <p class="eo-mini">
      Auxiliary aids and services are available upon request to individuals with disabilities. TTY via Relay 711. 
      Language assistance is available free of charge. 
      <a href="/policies/eo.html">Equal Opportunity Is the Law</a>.
    </p>
  </footer>

  <script type="module">
    // Import Supabase client
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
    
    // Initialize Supabase client with environment variables
    const supabaseUrl = import.meta.env?.VITE_SUPABASE_URL || 'YOUR_SUPABASE_URL';
    const supabaseAnonKey = import.meta.env?.VITE_SUPABASE_ANON_KEY || 'YOUR_SUPABASE_ANON_KEY';
    
    if (supabaseUrl === 'YOUR_SUPABASE_URL' || supabaseAnonKey === 'YOUR_SUPABASE_ANON_KEY') {
      document.getElementById('msg').textContent = 'Authentication service not configured. Please contact support.';
      document.getElementById('googleBtn').disabled = true;
    } else {
      const supabase = createClient(supabaseUrl, supabaseAnonKey);
      
      // Get redirect URL from query parameters
      const params = new URLSearchParams(location.search);
      const redirectTo = params.get('redirect') || '/portal/';
      
      // Check if user is already signed in
      supabase.auth.getSession().then(({ data: { session } }) => {
        if (session) {
          // User is already signed in, redirect them
          window.location.href = redirectTo;
        }
      });
      
      // Handle Google sign-in
      document.getElementById('googleBtn').onclick = async () => {
        const msgElement = document.getElementById('msg');
        msgElement.textContent = 'Signing in...';
        
        try {
          const { data, error } = await supabase.auth.signInWithOAuth({
            provider: 'google',
            options: {
              redirectTo: `${window.location.origin}/login-callback.html?redirect=${encodeURIComponent(redirectTo)}`
            }
          });
          
          if (error) {
            msgElement.textContent = `Sign-in error: ${error.message}`;
          }
          // If successful, the user will be redirected to Google
        } catch (err) {
          msgElement.textContent = `Unexpected error: ${err.message}`;
        }
      };
    }
  </script>
</body>
</html>