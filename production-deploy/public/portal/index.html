<!doctype html>
<html lang="en">
<head>
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:; frame-ancestors 'none';">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  <meta charset="utf-8" />
  <title>Student Portal ‚Äì Elevate for Humanity</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>
  
  <header class="site-header" role="banner">
    <nav class="nav" aria-label="Primary navigation">
      <a class="brand" href="/" aria-label="Elevate for Humanity home">
        <img src="https://cdn.elevateforhumanity.org/images/brand/efh-logo.svg" alt="Elevate for Humanity" height="40" width="200">
      </a>
      <ul class="nav-list">
        <li><a href="/portal/">Dashboard</a></li>
        <li><a href="/student-portal.html">Learning</a></li>
        <li><a href="/enroll/">Enrollment</a></li>
        <li><a href="/">Public Site</a></li>
      </ul>
      <button class="btn" id="signOutBtn">Sign Out</button>
    </nav>
  </header>

  <main class="section" id="main">
    <h1>Student Portal Dashboard</h1>
    
    <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 0.5rem; padding: 1rem; margin: 2rem 0;">
      <h2>üéâ Authentication Successful!</h2>
      <p>You have successfully signed in and accessed the protected student portal. This page is only accessible to authenticated users.</p>
    </div>

    <section>
      <h2>Welcome to Your Dashboard</h2>
      <p>This is a protected area that requires authentication. The Netlify Edge Function verified your Supabase session before allowing access to this page.</p>
      
      <div class="cards">
        <div class="card">
          <div class="card-body">
            <h3>üìö Learning Management</h3>
            <p>Access your courses, assignments, and progress tracking.</p>
            <a class="btn" href="/student-portal.html">Go to Student Portal</a>
          </div>
        </div>
        
        <div class="card">
          <div class="card-body">
            <h3>üìù Enrollment</h3>
            <p>Manage your program enrollment and course registration.</p>
            <a class="btn" href="/enroll/">Enrollment System</a>
          </div>
        </div>
        
        <div class="card">
          <div class="card-body">
            <h3>üë§ Profile</h3>
            <p>Update your personal information and preferences.</p>
            <a class="btn" href="/portal/profile.html">View Profile</a>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2>User Information</h2>
      <div id="userInfo" style="background: #f8f9fa; border-radius: 0.5rem; padding: 1rem;">
        <p>Loading user information...</p>
      </div>
    </section>
  </main>

  <footer class="site-footer" role="contentinfo">
    <section class="footer-grid">
      <div>
        <h3>Student Support</h3>
        <p>
          <strong>Phone:</strong> <a href="tel:+1-317-555-9675">(317) 555-WORK</a><br>
          <strong>Email:</strong> <a href="mailto:support@elevateforhumanity.org">support@elevateforhumanity.org</a>
        </p>
      </div>
      <div>
        <h3>Quick Links</h3>
        <ul class="linklist">
          <li><a href="/portal/">Dashboard</a></li>
          <li><a href="/student-portal.html">Learning Management</a></li>
          <li><a href="/enroll/">Enrollment</a></li>
          <li><a href="/policies/accessibility.html">Accessibility</a></li>
        </ul>
      </div>
    </section>
  </footer>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
    
    const supabaseUrl = import.meta.env?.VITE_SUPABASE_URL || 'YOUR_SUPABASE_URL';
    const supabaseAnonKey = import.meta.env?.VITE_SUPABASE_ANON_KEY || 'YOUR_SUPABASE_ANON_KEY';
    
    if (supabaseUrl !== 'YOUR_SUPABASE_URL' && supabaseAnonKey !== 'YOUR_SUPABASE_ANON_KEY') {
      const supabase = createClient(supabaseUrl, supabaseAnonKey);
      
      // Get user information
      supabase.auth.getUser().then(({ data: { user }, error }) => {
        const userInfoDiv = document.getElementById('userInfo');
        
        if (error) {
          userInfoDiv.innerHTML = `<p style="color: var(--danger);">Error loading user info: ${error.message}</p>`;
        } else if (user) {
          userInfoDiv.innerHTML = `
            <h3>Signed in as:</h3>
            <p><strong>Email:</strong> ${user.email}</p>
            <p><strong>Name:</strong> ${user.user_metadata?.full_name || 'Not provided'}</p>
            <p><strong>Provider:</strong> ${user.app_metadata?.provider || 'Unknown'}</p>
            <p><strong>Last Sign In:</strong> ${new Date(user.last_sign_in_at).toLocaleString()}</p>
          `;
        } else {
          userInfoDiv.innerHTML = '<p style="color: var(--warning);">No user information available</p>';
        }
      });
      
      // Handle sign out
      document.getElementById('signOutBtn').onclick = async () => {
        const { error } = await supabase.auth.signOut();
        if (error) {
          alert(`Sign out error: ${error.message}`);
        } else {
          // Clear the cookie
          document.cookie = 'sb-access-token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
          // Redirect to home page
          window.location.href = '/';
        }
      };
    } else {
      document.getElementById('userInfo').innerHTML = '<p style="color: var(--warning);">Supabase not configured - this is a demo page</p>';
      document.getElementById('signOutBtn').onclick = () => {
        alert('Sign out not available in demo mode');
      };
    }
  </script>
</body>
</html>