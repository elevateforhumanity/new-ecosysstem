<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:; frame-ancestors 'none';">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Elevate License Manager Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .license-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    
            
<div class="border-b pb-2 mb-4"></div>

<div><strong>Licensee:</strong> ${license.licensee}</div>
<div><strong>Domain:</strong> ${license.domain}</div>
<div><strong>License Key:</strong> ${license.licenseKey}</div>
<div><strong>Tier:</strong> ${license.tier.toUpperCase()}</div>
<div><strong>Features:</strong> ${license.features.join(', ')}</div>
<div><strong>Issued:</strong> ${new Date(license.issued).toLocaleDateString()}</div>
<div><strong>Expires:</strong> ${new Date(license.expires).toLocaleDateString()}</div>
<div><strong>Status:</strong> <span class="text-green-600 font-semibold">${license.status.toUpperCase()}</span></div>

<div class="border-t pt-4 mt-4">
<div class="text-xs text-gray-500">
¬© 2024 Selfish Inc. DBA Rise Foundation. All Rights Reserved.
Licensed Use Only - Unauthorized use prohibited.
</div>
</div>
</div>
            `;

            // Save to recent licenses
            recentLicenses.unshift(license);
            if (recentLicenses.length > 10) recentLicenses.pop();
            localStorage.setItem('elevate_licenses', JSON.stringify(recentLicenses));
            
            updateRecentLicensesTable();
        }

        function generateLicenseKey(domain, tier) {
            const prefix = 'EFH';
            const tierCode = tier.substring(0, 3).toUpperCase();
            const domainHash = CryptoJS.MD5(domain).toString().substring(0, 8).toUpperCase();
            const timestamp = Date.now().toString(36).toUpperCase();
            
            return `${prefix}-${tierCode}-${domainHash}-${timestamp}`;
        }

        function copyLicense() {
            if (!currentLicense) {
                alert('Please generate a license first');
                return;
            }

            const licenseText = JSON.stringify(currentLicense, null, 2);
            navigator.clipboard.writeText(licenseText).then(() => {
                alert('License copied to clipboard!');
            });
        }

        function signLicense() {
            if (!currentLicense) {
                alert('Please generate a license first');
                return;
            }

            // Generate digital signature
            const licenseData = JSON.stringify(currentLicense);
            const signature = CryptoJS.HmacSHA256(licenseData, 'elevate-secret-key').toString();
            
            currentLicense.signature = signature;
            currentLicense.signed = true;
            currentLicense.signedAt = new Date().toISOString();

            alert('License digitally signed successfully!');
            
            // Update display
            const output = document.getElementById('licenseOutput');
            output.innerHTML += `
<div class="border-t pt-2 mt-2">
<div class="text-green-600 font-semibold">‚úÖ DIGITALLY SIGNED</div>
<div class="text-xs text-gray-500">Signature: ${signature.substring(0, 32)}...</div>
<div class="text-xs text-gray-500">Signed: ${new Date().toLocaleString()}</div>
</div>
            `;
        }

        function generatePDF() {
            if (!currentLicense) {
                alert('Please generate a license first');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Header
            doc.setFontSize(20);
            doc.setTextColor(30, 27, 75);
            doc.text('ELEVATE FOR HUMANITY', 105, 30, { align: 'center' });
            
            doc.setFontSize(14);
            doc.setTextColor(100, 100, 100);
            doc.text('LICENSE CERTIFICATE', 105, 40, { align: 'center' });

            // License details
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            const details = [
                ['Licensee:', currentLicense.licensee],
                ['Domain:', currentLicense.domain],
                ['License Key:', currentLicense.licenseKey],
                ['Tier:', currentLicense.tier.toUpperCase()],
                ['Features:', currentLicense.features.join(', ')],
                ['Issued:', new Date(currentLicense.issued).toLocaleDateString()],
                ['Expires:', new Date(currentLicense.expires).toLocaleDateString()],
                ['Status:', currentLicense.status.toUpperCase()]
            ];

            let y = 60;
            details.forEach(([label, value]) => {
                doc.setFont(undefined, 'bold');
                doc.text(label, 20, y);
                doc.setFont(undefined, 'normal');
                doc.text(value, 70, y);
                y += 10;
            });

            // Terms
            y += 10;
            doc.setFontSize(10);
            doc.text('TERMS AND CONDITIONS:', 20, y);
            y += 8;
            
            const terms = [
                '‚Ä¢ This license is valid only for the specified domain and licensee.',
                '‚Ä¢ Unauthorized use, copying, or redistribution is strictly prohibited.',
                '‚Ä¢ License is non-transferable without written consent.',
                '‚Ä¢ Violation may result in immediate termination and legal action.'
            ];

            terms.forEach(term => {
                doc.text(term, 20, y);
                y += 6;
            });

            // Footer
            y += 20;
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100);
            doc.text('¬© 2024 Selfish Inc. DBA Rise Foundation. All Rights Reserved.', 105, y, { align: 'center' });
            doc.text('Licensed Use Only - Unauthorized use prohibited', 105, y + 5, { align: 'center' });

            // Save PDF
            const filename = `license-${currentLicense.domain.replace(/[^a-zA-Z0-9]/g, '-')}-${Date.now()}.pdf`;
            doc.save(filename);
        }

        function emailLicense() {
            const email = document.getElementById('clientEmail').value;
            if (!email) {
                alert('Please enter client email address');
                return;
            }

            if (!currentLicense) {
                alert('Please generate a license first');
                return;
            }

            // Simulate email sending (in real implementation, this would call your email API)
            const subject = `Elevate Platform License - ${currentLicense.domain}`;
            const body = `Dear ${currentLicense.licensee},

Your Elevate for Humanity platform license has been generated.

License Details:
- Domain: ${currentLicense.domain}
- Tier: ${currentLicense.tier}
- License Key: ${currentLicense.licenseKey}
- Expires: ${new Date(currentLicense.expires).toLocaleDateString()}

Please keep this license information secure.

Best regards,
Elevate for Humanity Licensing Team`;

            // Open email client
            window.open(`mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
            
            alert(`Email template opened for ${email}`);
        }

        function updateRecentLicensesTable() {
            const tbody = document.getElementById('licensesTableBody');
            tbody.innerHTML = recentLicenses.map(license => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${license.licensee}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${license.domain}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${
                            license.tier === 'enterprise' ? 'bg-purple-100 text-purple-800' :
                            license.tier === 'sister' ? 'bg-blue-100 text-blue-800' :
                            'bg-gray-100 text-gray-800'
                        }">${license.tier}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(license.expires).toLocaleDateString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">${license.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewLicense('${license.id}')" class="text-blue-600 hover:text-blue-900 mr-3">View</button>
                        <button onclick="revokeLicense('${license.id}')" class="text-red-600 hover:text-red-900">Revoke</button>
                    </td>
                </tr>
            `).join('');
        }

        function viewLicense(id) {
            const license = recentLicenses.find(l => l.id === id);
            if (license) {
                currentLicense = license;
                
                // Populate form
                document.getElementById('licensee').value = license.licensee;
                document.getElementById('domain').value = license.domain;
                document.getElementById('tier').value = license.tier;
                document.getElementById('expires').value = license.expires.split('T')[0];
                
                // Update display
                generateLicense();
            }
        }

        function revokeLicense(id) {
            if (confirm('Are you sure you want to revoke this license?')) {
                const licenseIndex = recentLicenses.findIndex(l => l.id === id);
                if (licenseIndex !== -1) {
                    recentLicenses[licenseIndex].status = 'revoked';
                    localStorage.setItem('elevate_licenses', JSON.stringify(recentLicenses));
                    updateRecentLicensesTable();
                    alert('License revoked successfully');
                }
            }
        }

        // Initialize
        updateRecentLicensesTable();
    </script>
</body>
</html>