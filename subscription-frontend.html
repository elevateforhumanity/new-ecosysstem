
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; img-src 'self' data: https:; font-src 'self' https:; connect-src 'self' https:; frame-ancestors 'none';">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Your Learning Plan | EFH</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    ' : ''}
                        <h3 class="text-2xl font-bold mb-2">${plan.name}</h3>
                        <div class="mb-6">
                            <span class="text-4xl font-bold">$${Math.floor(price / 100)}</span>
                            <span class="text-gray-600">/${period}</span>
                            ${savings > 0 ? `<div class="text-green-600 text-sm">Save $${savings}/year</div>` : ''}
                        </div>
                        <ul class="space-y-3 mb-8">
                            ${plan.features.map(feature => `
                                <li class="flex items-center">
                                    <svg class="h-5 w-5 text-green-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    ${feature}
                                </li>
                            `).join('')}
                        </ul>
                        <button onclick="selectPlan('${plan.id}')" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            Get Started
                        </button>
                    </div>
                `;
            }).join('');
        }

        async function selectPlan(planId) {
            const email = prompt('Enter your email address:');
            if (!email) return;

            try {
                const response = await fetch('/api/subscription/checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email,
                        planId,
                        billingPeriod: currentBilling
                    })
                });

                const data = await response.json();
                if (data.url) {
                    window.location.href = data.url;
                } else {
                    alert('Failed to create subscription. Please try again.');
                }
            } catch (error) {
                console.error('Subscription error:', error);
                alert('Something went wrong. Please try again.');
            }
        }

        // Billing toggle functionality
        document.getElementById('monthly-btn').addEventListener('click', () => {
            currentBilling = 'monthly';
            document.getElementById('monthly-btn').className = 'px-4 py-2 rounded-md text-sm font-medium bg-blue-600 text-white';
            document.getElementById('yearly-btn').className = 'px-4 py-2 rounded-md text-sm font-medium text-gray-500';
            renderPlans();
        });

        document.getElementById('yearly-btn').addEventListener('click', () => {
            currentBilling = 'yearly';
            document.getElementById('yearly-btn').className = 'px-4 py-2 rounded-md text-sm font-medium bg-blue-600 text-white';
            document.getElementById('monthly-btn').className = 'px-4 py-2 rounded-md text-sm font-medium text-gray-500';
            renderPlans();
        });

        // Load plans on page load
        loadPlans();
    </script>
</body>
</html>
